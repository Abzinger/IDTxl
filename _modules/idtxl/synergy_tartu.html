<!DOCTYPE html>




<html lang="en">
  <head>
    <meta charset="utf-8" />
    
    <title>idtxl.synergy_tartu &mdash; IDTxl 0.1 documentation</title>
    <meta name="description" content="">
    <meta name="author" content="">

    

<link rel="stylesheet" href="../../_static/css/basicstrap-base.css" type="text/css" />
<link rel="stylesheet" id="current-theme" href="../../_static/css/bootstrap3/bootswatch-spacelab.css" type="text/css" />
<link rel="stylesheet" id="current-adjust-theme" href="../../_static/css/adjust_theme/bootswatch-spacelab.css" type="text/css" />

<link rel="stylesheet" href="../../_static/css/font-awesome.min.css">

<style type="text/css">
  body {
    padding-top: 60px;
    padding-bottom: 40px;
  }
</style>

<link rel="stylesheet" href="../../_static/css/basicstrap.css" type="text/css" />
<link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    '../../',
            VERSION:     '0.1',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
  };
</script>
    <script type="text/javascript" src="../../_static/js/jquery.min.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../_static/js/bootstrap3.min.js"></script>
<script type="text/javascript" src="../../_static/js/jquery.cookie.min.js"></script>
<script type="text/javascript" src="../../_static/js/basicstrap.js"></script>
<script type="text/javascript">
</script>
    <link rel="top" title="IDTxl 0.1 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body role="document">
    <div id="navbar-top" class="navbar navbar-fixed-top navbar-default" role="navigation" aria-label="top navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../../index.html">IDTxl 0.1 documentation</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">

            
              <li><a href="../../py-modindex.html" title="Python Module Index" >modules </a></li>
              <li><a href="../../genindex.html" title="General Index" accesskey="I">index </a></li>
              <li><a href="../index.html" accesskey="U">Module code</a></li>
            

            <li class="visible-xs">
                <form class="search form-search form-inline navbar-form navbar-right sp-searchbox" action="../../search.html" method="get">
                  <div class="input-append input-group">
                    <input type="text" class="search-query form-control" name="q" placeholder="Search...">
                    <span class="input-group-btn">
                    <input type="submit" class="btn" value="Go" />
                    </span>
                  </div>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </li>

            

          </ul>

        </div>
      </div>
    </div>
    

    <!-- container -->
    <div class="container">

      <!-- row -->
      <div class="row">
        
        

        <div class="col-md-9" id="content-wrapper">
          <div class="document" role="main">
            <div class="documentwrapper">
              <div class="bodywrapper">
                <div class="body">
                  
  <h1>Source code for idtxl.synergy_tartu</h1><div class="highlight"><pre>
<span class="c1"># This is file TartuSynergy.py  ( Python 3.x )</span>
<span class="c1"># Uses numpy, cvxopt, and gurobipy</span>
<span class="c1">#</span>
<span class="c1"># +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>
<span class="c1">#</span>
<span class="c1"># Main function: solve_PDF()</span>
<span class="c1"># ==========================</span>
<span class="c1">#</span>
<span class="c1"># Takes a joint probability density function of three RVs X,Y,Z, and</span>
<span class="c1"># computes synergetic and shared information parts of I( X ; YZ ).</span>
<span class="c1">#</span>
<span class="c1"># How does it do that?</span>
<span class="c1"># --------------------</span>
<span class="c1">#</span>
<span class="c1"># Iteratively solves Convex Programs (CVXOPT), then attempts to ``tidy</span>
<span class="c1"># up&#39;&#39; the solution by setting variables which are ``dirty zeros&#39;&#39; to</span>
<span class="c1"># actual zeros. For deciding which variables are dirty zeros, it</span>
<span class="c1"># solves a sequence of Linear Programs (Gurobi).</span>
<span class="c1">#</span>
<span class="c1"># Usage</span>
<span class="c1"># -----</span>
<span class="c1">#</span>
<span class="c1"># def solve_PDF(pdf, true_pdf=None, true_result=None, true_CI=None,</span>
<span class="c1">#               true_SI=None,</span>
<span class="c1">#               feas_eps  =1.e-10, feas_eps_2 =1.e-6,</span>
<span class="c1">#               kkt_eps   =1.e-5,  kkt_eps_2  =.01,</span>
<span class="c1">#               kkt_search_eps =.5, max_zero_probability=1.e-5,</span>
<span class="c1">#               verbose=False):</span>
<span class="c1">#</span>
<span class="c1"># PARAMETERS</span>
<span class="c1">#</span>
<span class="c1"># pdf                  The probability density function.</span>
<span class="c1">#                      Dictionary mapping triples to real numbers.</span>
<span class="c1">#                      The first in the triple is the `dependent&#39; RV,</span>
<span class="c1">#                      i.e. P( X=x, Y=y, Z=z )  = pdf[ x,y,z ] .</span>
<span class="c1"># true_pdf             If `pdf&#39; is an approximation of a known `true&#39; PDF,</span>
<span class="c1">#                      you can give the true pdf here, to get more detailed</span>
<span class="c1">#                      info (if verbose is True)</span>
<span class="c1"># true_result          If the `right&#39; optimal PDF is known, give it here to</span>
<span class="c1">#                      have more detailed output (if verbose is True)</span>
<span class="c1"># true_CI              If the synergetic info is known, give it here to have</span>
<span class="c1">#                      more detailed output (if verbose is True)</span>
<span class="c1"># true_SI              If the shared information is known, give it here to</span>
<span class="c1">#                      have more detailed output (if verbose is True)</span>
<span class="c1"># feas_eps             Maximal sum of violations of marginal equations that is</span>
<span class="c1">#                      desirable.  Default: 1.e-10</span>
<span class="c1"># kkt_eps              Maximal maximum of violations of KKT-system constraints</span>
<span class="c1">#                      that is desirable. Default: 1.e-5</span>
<span class="c1"># feas_eps_2           If no further improvement can be found,</span>
<span class="c1">#                      this violation of the marginal equations is acceptable.</span>
<span class="c1">#                      Default: 1.e-6</span>
<span class="c1"># kkt_eps_2            If no further improvement can be found,</span>
<span class="c1">#                      this KKT-system maximum constraint violation is</span>
<span class="c1">#                      acceptable. Default: .01</span>
<span class="c1"># kkt_search_eps       During iterative search for improvements,</span>
<span class="c1">#                      when variables are scanned to be set to 0,</span>
<span class="c1">#                      if the KKT-system maximum violation drops by this</span>
<span class="c1">#                      factor, that improvement is taken. Default: .5</span>
<span class="c1"># max_zero_probability During iterative search for improvements,</span>
<span class="c1">#                      when variables are scanned to be set to 0,</span>
<span class="c1">#                      this is the largest probability which can be considered</span>
<span class="c1">#                      to be really 0.  Default: 1.e-5</span>
<span class="c1"># verbose              If True, produce lots of intermediate output.</span>
<span class="c1">#                      Default: False</span>
<span class="c1">#</span>
<span class="c1"># RETURN VALUE</span>
<span class="c1">#</span>
<span class="c1"># The function returns a quadruple:  opt_pdf,feas,kkt,CI,SI</span>
<span class="c1">#</span>
<span class="c1"># opt_pdf              The optimal (or best guess) PDF found</span>
<span class="c1"># feas                 Sum of violations of the marginal equations of opt_pdf</span>
<span class="c1">#                      Max of violations of the KKT-system constraints</span>
<span class="c1"># CI, SI               Synergetic and shared information</span>
<span class="c1">#</span>
<span class="c1"># ^ END OF DOCUMENTATION</span>
<span class="c1"># +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">idtxl_exceptions</span> <span class="k">as</span> <span class="n">ex</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">gurobipy</span> <span class="kn">as</span> <span class="nn">gurobi</span>
<span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
    <span class="n">ex</span><span class="o">.</span><span class="n">package_missing</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="s1">&#39;gurobipy is not available on this system. Install&#39;</span>
                            <span class="s1">&#39; it from https://www.gurobi.com/ to use the&#39;</span>
                            <span class="s1">&#39;Tartu PID-estimator.&#39;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">cvxopt</span> <span class="kn">import</span> <span class="n">solvers</span><span class="p">,</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">spmatrix</span><span class="p">,</span> <span class="n">spdiag</span><span class="p">,</span> <span class="n">log</span>
<span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
    <span class="n">ex</span><span class="o">.</span><span class="n">package_missing</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="s1">&#39;cvxopt is not available on this system. Install &#39;</span>
                            <span class="s1">&#39;it through pip to use the Tartu PID-estimator.&#39;</span><span class="p">)</span>

<span class="n">VERBOSE</span> <span class="o">=</span> <span class="bp">False</span>

<span class="c1"># ******************************************************************************************************************************************************</span>
<span class="c1"># *  M a r g i n a l s</span>


<div class="viewcode-block" id="marginal_xy"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.marginal_xy">[docs]</a><span class="k">def</span> <span class="nf">marginal_xy</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="n">marg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">xyz</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="n">marg</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">marg</span><span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">r</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">marg</span><span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)]</span> <span class="o">=</span> <span class="n">r</span>
    <span class="k">return</span> <span class="n">marg</span></div>


<div class="viewcode-block" id="marginal_xz"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.marginal_xz">[docs]</a><span class="k">def</span> <span class="nf">marginal_xz</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="n">marg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">xyz</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="n">marg</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">marg</span><span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">r</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">marg</span><span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">)]</span> <span class="o">=</span> <span class="n">r</span>
    <span class="k">return</span> <span class="n">marg</span></div>


<div class="viewcode-block" id="marginal_yz"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.marginal_yz">[docs]</a><span class="k">def</span> <span class="nf">marginal_yz</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="n">marg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">xyz</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="n">marg</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">marg</span><span class="p">[(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">r</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">marg</span><span class="p">[(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)]</span> <span class="o">=</span> <span class="n">r</span>
    <span class="k">return</span> <span class="n">marg</span></div>


<div class="viewcode-block" id="marginal_yz_with_cutoff"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.marginal_yz_with_cutoff">[docs]</a><span class="k">def</span> <span class="nf">marginal_yz_with_cutoff</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ZERO</span><span class="o">=</span><span class="mf">1.e-1000</span><span class="p">):</span>
    <span class="n">marg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="n">ZERO</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">xyz</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="n">marg</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">marg</span><span class="p">[(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">r</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">marg</span><span class="p">[(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)]</span> <span class="o">=</span> <span class="n">r</span>
    <span class="k">return</span> <span class="n">marg</span></div>


<div class="viewcode-block" id="marginal_x"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.marginal_x">[docs]</a><span class="k">def</span> <span class="nf">marginal_x</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="n">marg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">xyz</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">marg</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">marg</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">+=</span> <span class="n">r</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">marg</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span>
    <span class="k">return</span> <span class="n">marg</span></div>


<div class="viewcode-block" id="marginal_y"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.marginal_y">[docs]</a><span class="k">def</span> <span class="nf">marginal_y</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="n">marg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">xyz</span>
        <span class="k">if</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">marg</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">marg</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">+=</span> <span class="n">r</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">marg</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span>
    <span class="k">return</span> <span class="n">marg</span></div>


<div class="viewcode-block" id="marginal_z"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.marginal_z">[docs]</a><span class="k">def</span> <span class="nf">marginal_z</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="n">marg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">xyz</span>
        <span class="k">if</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">marg</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">marg</span><span class="p">[</span><span class="n">z</span><span class="p">]</span> <span class="o">+=</span> <span class="n">r</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">marg</span><span class="p">[</span><span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span>
    <span class="k">return</span> <span class="n">marg</span></div>

<span class="c1">#^ marginals</span>
<span class="c1"># ******************************************************************************************************************************************************</span>


<span class="c1"># ******************************************************************************************************************************************************</span>
<span class="c1"># *  C L A S S   for the computation of unique information</span>
<div class="viewcode-block" id="Compute_UI"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.Compute_UI">[docs]</a><span class="k">class</span> <span class="nc">Compute_UI</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">marg_xy</span><span class="p">,</span> <span class="n">marg_xz</span><span class="p">,</span> <span class="n">_set_to_zero</span><span class="o">=</span><span class="nb">set</span><span class="p">()):</span>
        <span class="c1"># marg_xy is a dictionary     (x,y) --&gt; positive double</span>
        <span class="c1"># marg_xz is a dictionary     (x,z) --&gt; positive double</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">orig_marg_xy</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orig_marg_xz</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_eps</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q_xy</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q_xz</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_idx</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">marg_of_idx</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># triples xyz -- the missing one is None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_equations_called</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_ieqs_called</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_0</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># initial solution</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solver_ret</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_final</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_to_zero</span> <span class="o">=</span> <span class="n">_set_to_zero</span>

        <span class="c1"># Options:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expensive_initial_solution</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose_output</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c1"># Actual code:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orig_marg_xy</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">marg_xy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orig_marg_xz</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">marg_xz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orig_marg_xy</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span> <span class="o">+</span>
                     <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orig_marg_xz</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orig_marg_xy</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">z</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orig_marg_xz</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
    <span class="c1"># __init__()</span>

    <span class="c1"># tidy_up_distrib():</span>
<div class="viewcode-block" id="Compute_UI.tidy_up_distrib"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.Compute_UI.tidy_up_distrib">[docs]</a>    <span class="k">def</span> <span class="nf">tidy_up_distrib</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">eps</span><span class="p">):</span>
        <span class="c1"># returns a tidied-up copy of p: every entry smaller than eps is</span>
        <span class="c1"># treated as 0.</span>
        <span class="n">p_new</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">one</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">r</span> <span class="o">&gt;=</span> <span class="n">eps</span><span class="p">:</span>
                <span class="n">p_new</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span>
                <span class="n">one</span> <span class="o">+=</span> <span class="n">r</span>
        <span class="c1"># Re-normalize --- Should I drop this ??? ?!?</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">p_new</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">p_new</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span> <span class="o">/</span> <span class="n">one</span>

        <span class="k">return</span> <span class="n">p_new</span></div>
    <span class="c1"># tidy_up_distrib()</span>

    <span class="c1"># create_equations():</span>
<div class="viewcode-block" id="Compute_UI.create_equations"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.Compute_UI.create_equations">[docs]</a>    <span class="k">def</span> <span class="nf">create_equations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># The point is that all the double values are considered non-zero</span>
        <span class="c1"># This function</span>
        <span class="c1">#  - creates the sets X,Y,Z</span>
        <span class="c1">#  - creates the dictionary var_idx: variables --&gt; index of the variable</span>
        <span class="c1">#  - creates the matrices A,b: two types of marginal equations: p(x,y,*)==p_xy(x,y), p(x,*,z)==p_xz(x,z)</span>
        <span class="c1">#  - A has full rank: unneeded eqns are thrown out</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_equations_called</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Some dork called create_equations twice...&quot;</span><span class="p">)</span>
            <span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_equations_called</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="n">count_vars</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_idx</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_xy</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_to_zero</span> <span class="ow">and</span>
                                <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_xz</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">var_idx</span><span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)]</span> <span class="o">=</span> <span class="n">count_vars</span>
                            <span class="n">count_vars</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">list_b</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list of RHSs</span>
        <span class="c1"># coefficient matrix in row-major (need column-major later)</span>
        <span class="n">list_At</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># DEBUG: omited equations go here---then we check whether the ranks are</span>
        <span class="c1"># equal</span>
        <span class="n">list_At_throwout</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">numo_thrownout</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">marg_of_idx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># xy-marginal equations</span>
        <span class="k">for</span> <span class="n">xy</span><span class="p">,</span> <span class="n">rhs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_xy</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">xy</span>
            <span class="c1"># initialize the whole row with 0</span>
            <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">xyz</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_idx</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_idx</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_idx</span><span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)]</span>
                    <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
            <span class="c1"># list_At += a # splice !</span>
            <span class="c1"># list_b.append( rhs )</span>
            <span class="c1"># self.marg_of_idx.append(  (x,y,None)  )</span>

            <span class="c1"># We test if adding this equation increases the rank.</span>
            <span class="c1"># Because of the deleted variables (in set_to_zero), I don&#39;t know</span>
            <span class="c1"># of a better way to do this...</span>
            <span class="n">tmp_At</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span>
                <span class="n">list_At</span> <span class="o">+</span> <span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var_idx</span><span class="p">),</span>  <span class="nb">len</span><span class="p">(</span><span class="n">list_b</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;d&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">matrix_rank</span><span class="p">(</span><span class="n">tmp_At</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_b</span><span class="p">):</span>
                <span class="n">list_At</span> <span class="o">+=</span> <span class="n">a</span>  <span class="c1"># splice !</span>
                <span class="n">list_b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">marg_of_idx</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>

        <span class="c1"># xz-marginal equations</span>
        <span class="k">for</span> <span class="n">xz</span><span class="p">,</span> <span class="n">rhs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_xz</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">xz</span>
            <span class="c1"># initialize the whole row with 0</span>
            <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">xyz</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_idx</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_idx</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_idx</span><span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)]</span>
                    <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
            <span class="c1"># Rank-check again:</span>
            <span class="n">tmp_At</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span>
                <span class="n">list_At</span> <span class="o">+</span> <span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var_idx</span><span class="p">),</span>  <span class="nb">len</span><span class="p">(</span><span class="n">list_b</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;d&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">matrix_rank</span><span class="p">(</span><span class="n">tmp_At</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_b</span><span class="p">):</span>
                <span class="n">list_At</span> <span class="o">+=</span> <span class="n">a</span>  <span class="c1"># splice !</span>
                <span class="n">list_b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">marg_of_idx</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>

        <span class="c1"># Now we create the cvxop matrix.</span>
        <span class="c1"># Keep in mind: in list_At, there&#39;s one equation too many, they are</span>
        <span class="c1"># linearly dependent.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">list_b</span><span class="p">,</span>                   <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_b</span><span class="p">),</span>        <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;d&#39;</span><span class="p">)</span>
        <span class="n">At</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">list_At</span><span class="p">,</span>                  <span class="p">(</span><span class="nb">len</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var_idx</span><span class="p">),</span>  <span class="nb">len</span><span class="p">(</span><span class="n">list_b</span><span class="p">)),</span> <span class="s1">&#39;d&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">=</span> <span class="n">At</span><span class="o">.</span><span class="n">T</span>
        <span class="n">rk</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">matrix_rank</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">rk</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_b</span><span class="p">)):</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;BUG: There&#39;s something wrong with the rank of the &quot;</span>
                  <span class="s2">&quot;coefficient matrix: it is &quot;</span><span class="p">,</span> <span class="n">rk</span><span class="p">,</span> <span class="s2">&quot; it should be &quot;</span><span class="p">,</span>
                  <span class="nb">len</span><span class="p">(</span><span class="n">list_b</span><span class="p">))</span>
            <span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">dim_space</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var_idx</span><span class="p">)</span> <span class="o">-</span> <span class="n">rk</span>
        <span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Solution space has dimension &quot;</span><span class="p">,</span> <span class="n">dim_space</span><span class="p">)</span></div>

<div class="viewcode-block" id="Compute_UI.create_ieqs"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.Compute_UI.create_ieqs">[docs]</a>    <span class="k">def</span> <span class="nf">create_ieqs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_equations_called</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;You have to call create_equations() before calling &quot;</span>
                  <span class="s2">&quot;create_ieqs()&quot;</span><span class="p">)</span>
            <span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_ieqs_called</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Some dork called create_ieqs() twice...&quot;</span><span class="p">)</span>
            <span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_ieqs_called</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">=</span> <span class="n">spdiag</span><span class="p">(</span><span class="n">matrix</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var_idx</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;d&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var_idx</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;d&#39;</span><span class="p">)</span></div>

    <span class="c1"># CALLBACK fn for computing  f, grad f, Hess f</span>
<div class="viewcode-block" id="Compute_UI.callback"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.Compute_UI.callback">[docs]</a>    <span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">zz</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var_idx</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">list_p_0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span> <span class="k">for</span> <span class="n">xyz</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_idx</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
            <span class="k">for</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_idx</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">list_p_0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>  <span class="c1"># self.p_0[xyz]</span>
            <span class="c1"># This is returns the starting solution for the iterative solution</span>
            <span class="c1"># of the CP --- this is the 1st point to experiment with other</span>
            <span class="c1"># distributions with the same marginals.</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="n">matrix</span><span class="p">(</span><span class="n">list_p_0</span><span class="p">,</span> <span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;d&#39;</span><span class="p">)</span>

        <span class="c1"># check if p is in the feasible region for the objective function:</span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">max</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="n">p_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">xyz</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_idx</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">p_yz</span> <span class="o">=</span> <span class="n">marginal_yz</span><span class="p">(</span><span class="n">p_dict</span><span class="p">)</span>

        <span class="c1"># Compute f(p)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_idx</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">xyz</span>
            <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">+=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">p_yz</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span>
<span class="c1">#            if p[i] &gt; 1.e-10: f += p[i]*log(p[i]/p_yz[y,z])</span>

        <span class="c1"># Compute gradient-transpose Df(p)</span>
        <span class="n">list_Df</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span> <span class="k">for</span> <span class="n">xyz</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_idx</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_idx</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">xyz</span>
            <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">list_Df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">p_yz</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span>
<span class="c1">#            if p[i] &gt; 1.e-30:  list_Df[i] = log( p[i] / p_yz[y,z] )</span>
        <span class="n">Df</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">list_Df</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="s1">&#39;d&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">zz</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">,</span> <span class="n">Df</span>

        <span class="c1"># Compute zz[0] * Hess f</span>
        <span class="c1"># This will be a sparse matrix</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_idx</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">xyz</span>
            <span class="n">p_yz__x</span> <span class="o">=</span> <span class="n">p_yz</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># sum_{* \ne x} p(*,y,z).</span>
            <span class="k">for</span> <span class="n">x_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">x_</span> <span class="o">==</span> <span class="n">x</span><span class="p">:</span>  <span class="c1"># diagonal</span>
                    <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="c1"># 1/p[x,y,z] - 1/p[*,y,z] = ( p[*,y,z] - p[x,y,z] )/(</span>
                    <span class="c1"># p[*,y,z] p[x,y,z] )</span>
                    <span class="n">tmp_quot</span> <span class="o">=</span> <span class="n">zz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">p_yz__x</span> <span class="o">/</span> <span class="n">p_yz</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">tmp_quot</span><span class="p">:</span>
                        <span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_quot</span> <span class="o">/</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="c1">#                    if p[i] &gt; 1.e-100 * tmp_quot:   entries.append( tmp_quot / p[i] )</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;TROUBLE computing Hessian (diagonal)&quot;</span><span class="p">)</span>
                        <span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># off diagonal</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">x_</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_idx</span><span class="p">:</span>
                        <span class="n">j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_idx</span><span class="p">[(</span><span class="n">x_</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)]</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="o">-</span> <span class="n">zz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">p_yz</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span>
                        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                        <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                        <span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="c1"># if diagonal</span>
            <span class="c1"># for x_</span>
        <span class="c1"># for xyz,i</span>

        <span class="n">zH</span> <span class="o">=</span> <span class="n">spmatrix</span><span class="p">(</span><span class="n">entries</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="s1">&#39;d&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_output</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;p=&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
        <span class="c1"># # print(numpy.squeeze(zH/zz[0]))</span>
        <span class="c1"># print(&quot;var_idx=&quot;,self.var_idx)</span>
        <span class="c1"># print(&quot;p=&quot;,p_dict)</span>
        <span class="c1"># print(&quot;p_yz=&quot;,p_yz)</span>
        <span class="c1"># print(&quot;H=&quot;,zH)</span>
        <span class="c1"># # print(&quot;Eigen values of Hess f (p) are &quot;,numpy.linalg.eigvals(matrix(zH)),&quot;[&quot;,N,&quot;]&quot;)</span>
        <span class="c1"># print(&quot;Eigen vectors:\n&quot;, numpy.linalg.eigh(matrix(zH)))</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">,</span> <span class="n">Df</span><span class="p">,</span> <span class="n">zH</span></div>
    <span class="c1">#^ callback()</span>

    <span class="c1"># make_initial_solution()</span>
<div class="viewcode-block" id="Compute_UI.make_initial_solution"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.Compute_UI.make_initial_solution">[docs]</a>    <span class="k">def</span> <span class="nf">make_initial_solution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orig_q_0</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c1"># make initial solution q_0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_0</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">orig_q_0</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>  <span class="c1"># no initial solution provided. I&#39;m gonna get some &quot;minimum entropy&quot; thing</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expensive_initial_solution</span><span class="p">:</span>
                <span class="c1"># initial solution is the one minimizing || p ||^2</span>
                <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var_idx</span><span class="p">)</span>

                <span class="n">Q</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">spdiag</span><span class="p">(</span><span class="n">matrix</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;d&#39;</span><span class="p">))</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;d&#39;</span><span class="p">)</span>

                <span class="n">qp_solver</span> <span class="o">=</span> <span class="n">solvers</span><span class="o">.</span><span class="n">qp</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>

                <span class="c1"># for xyz,i in self.var_idx.items():</span>
                <span class="c1">#     self.p_0[xyz] = max(0, qp_solver[&#39;x&#39;][i] )</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Min 2-norm: &quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">qp_solver</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">xyz</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_idx</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">p_0</span><span class="p">[</span><span class="n">xyz</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">xyz</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_idx</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">xyz</span> <span class="ow">in</span> <span class="n">orig_q_0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">p_0</span><span class="p">[</span><span class="n">xyz</span><span class="p">]</span> <span class="o">=</span> <span class="n">orig_q_0</span><span class="p">[</span><span class="n">xyz</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">p_0</span><span class="p">[</span><span class="n">xyz</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span></div>

<div class="viewcode-block" id="Compute_UI.solve_it"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.Compute_UI.solve_it">[docs]</a>    <span class="k">def</span> <span class="nf">solve_it</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_eps</span><span class="o">=</span><span class="mf">1.e-10</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_eps</span> <span class="o">=</span> <span class="n">_eps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q_xy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tidy_up_distrib</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orig_marg_xy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_eps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q_xz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tidy_up_distrib</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orig_marg_xz</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_eps</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_output</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;q_xy=&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_xy</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;q_xz=&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_xz</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_equations</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_ieqs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_initial_solution</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_output</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p_0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">solver_ret</span> <span class="o">=</span> <span class="n">solvers</span><span class="o">.</span><span class="n">cp</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">,</span> <span class="n">G</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Solver terminated with status &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">solver_ret</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p_final</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_idx</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p_final</span><span class="p">[</span><span class="n">xyz</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solver_ret</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_final</span></div>


<div class="viewcode-block" id="Compute_UI.check_feasible"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.Compute_UI.check_feasible">[docs]</a>    <span class="k">def</span> <span class="nf">check_feasible</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">use_cleaned_up_margs</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">p_xy</span> <span class="o">=</span> <span class="n">marginal_xy</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">p_xz</span> <span class="o">=</span> <span class="n">marginal_xz</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">thesum</span> <span class="o">=</span> <span class="mf">0.</span>

        <span class="k">if</span> <span class="n">use_cleaned_up_margs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">:</span>
                    <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">xy</span> <span class="ow">in</span> <span class="n">p_xy</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">p_val</span> <span class="o">=</span> <span class="n">p_xy</span><span class="p">[</span><span class="n">xy</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">p_val</span> <span class="o">=</span> <span class="mf">0.</span>
                    <span class="k">if</span> <span class="n">xy</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_xy</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">q_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_xy</span><span class="p">[</span><span class="n">xy</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">q_val</span> <span class="o">=</span> <span class="mf">0.</span>
                    <span class="n">thesum</span> <span class="o">+=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">p_val</span> <span class="o">-</span> <span class="n">q_val</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
                    <span class="n">xz</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">xz</span> <span class="ow">in</span> <span class="n">p_xz</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">p_val</span> <span class="o">=</span> <span class="n">p_xz</span><span class="p">[</span><span class="n">xz</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">p_val</span> <span class="o">=</span> <span class="mf">0.</span>
                    <span class="k">if</span> <span class="n">xz</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_xz</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">q_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_xz</span><span class="p">[</span><span class="n">xz</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">q_val</span> <span class="o">=</span> <span class="mf">0.</span>
                    <span class="n">thesum</span> <span class="o">+=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">p_val</span> <span class="o">-</span> <span class="n">q_val</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># if NOT use cleaned up margs:</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">:</span>
                    <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">xy</span> <span class="ow">in</span> <span class="n">p_xy</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">p_val</span> <span class="o">=</span> <span class="n">p_xy</span><span class="p">[</span><span class="n">xy</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">p_val</span> <span class="o">=</span> <span class="mf">0.</span>
                    <span class="k">if</span> <span class="n">xy</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orig_marg_xy</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">q_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orig_marg_xy</span><span class="p">[</span><span class="n">xy</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">q_val</span> <span class="o">=</span> <span class="mf">0.</span>
                    <span class="n">thesum</span> <span class="o">+=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">p_val</span> <span class="o">-</span> <span class="n">q_val</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
                    <span class="n">xz</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">xz</span> <span class="ow">in</span> <span class="n">p_xz</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">p_val</span> <span class="o">=</span> <span class="n">p_xz</span><span class="p">[</span><span class="n">xz</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">p_val</span> <span class="o">=</span> <span class="mf">0.</span>
                    <span class="k">if</span> <span class="n">xz</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orig_marg_xz</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">q_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orig_marg_xz</span><span class="p">[</span><span class="n">xz</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">q_val</span> <span class="o">=</span> <span class="mf">0.</span>
                    <span class="n">thesum</span> <span class="o">+=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">p_val</span> <span class="o">-</span> <span class="n">q_val</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">thesum</span></div>

<div class="viewcode-block" id="Compute_UI.check_KKT_sol"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.Compute_UI.check_KKT_sol">[docs]</a>    <span class="k">def</span> <span class="nf">check_KKT_sol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">why</span><span class="p">):</span>
        <span class="n">p_yz</span> <span class="o">=</span> <span class="n">marginal_yz</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">viol</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span>

        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">idx_xy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">marg_of_idx</span><span class="o">.</span><span class="n">index</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">idx_xy</span> <span class="o">=</span> <span class="bp">None</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">idx_xz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">marg_of_idx</span><span class="o">.</span><span class="n">index</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">idx_xz</span> <span class="o">=</span> <span class="bp">None</span>

                    <span class="k">if</span> <span class="n">idx_xy</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">lambda_xy</span> <span class="o">=</span> <span class="bp">None</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lambda_xy</span> <span class="o">=</span> <span class="n">why</span><span class="p">[</span><span class="n">idx_xy</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">idx_xz</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">mu_xz</span> <span class="o">=</span> <span class="bp">None</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">mu_xz</span> <span class="o">=</span> <span class="n">why</span><span class="p">[</span><span class="n">idx_xz</span><span class="p">]</span>

                    <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c1"># equation</span>
                        <span class="n">p_xzy</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span>
                        <span class="n">rhs</span> <span class="o">=</span> <span class="o">-</span><span class="n">log</span><span class="p">(</span><span class="n">p_xzy</span> <span class="o">/</span> <span class="n">p_yz</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span>  <span class="c1"># &gt;= 0</span>
                        <span class="n">viol</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">viol</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">lambda_xy</span> <span class="o">+</span> <span class="n">mu_xz</span> <span class="o">-</span> <span class="n">rhs</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># inequality</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="n">p_yz</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">p_yz</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">lambda_xy</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">mu_xz</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                                <span class="k">pass</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">rhs</span> <span class="o">=</span> <span class="mf">1.e400</span>
                                <span class="n">viol</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">viol</span><span class="p">,</span> <span class="n">rhs</span> <span class="o">-</span> <span class="p">(</span><span class="n">lambda_xy</span> <span class="o">+</span> <span class="n">mu_xz</span><span class="p">))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">rhs</span> <span class="o">=</span> <span class="mf">0.</span>
                            <span class="n">viol</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">viol</span><span class="p">,</span> <span class="n">rhs</span> <span class="o">-</span> <span class="p">(</span><span class="n">lambda_xy</span> <span class="o">+</span> <span class="n">mu_xz</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">viol</span></div>

<div class="viewcode-block" id="Compute_UI.KKT_System"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.Compute_UI.KKT_System">[docs]</a>    <span class="k">class</span> <span class="nc">KKT_System</span><span class="p">:</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cui</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cui</span> <span class="o">=</span> <span class="n">cui</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">gurobi</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;kkt&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">logToConsole</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># Add the variables:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t_var</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lambda_vars</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mu_vars</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">t_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;t&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cui</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cui</span><span class="o">.</span><span class="n">Y</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lambda_vars</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;lambda(</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cui</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cui</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mu_vars</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;mu(</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

            <span class="c1"># Add the constraints:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">constr_leq</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">constr_geq</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cui</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cui</span><span class="o">.</span><span class="n">Y</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cui</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
                        <span class="n">rhs</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">constr_leq</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda_vars</span><span class="p">[</span>
                                                                        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu_vars</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">-</span> <span class="n">rhs</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_var</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;eq-le(</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">constr_geq</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda_vars</span><span class="p">[</span>
                                                                        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mu_vars</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">-</span> <span class="n">rhs</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">t_var</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;eq-ge(</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
                    <span class="c1">#^ for z</span>
                <span class="c1">#^ for y</span>
            <span class="c1">#^ for x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_time</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="c1">#^ __init__()</span>

<div class="viewcode-block" id="Compute_UI.KKT_System.solve"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.Compute_UI.KKT_System.solve">[docs]</a>        <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ZERO</span><span class="o">=</span><span class="mf">1.e-1000</span><span class="p">):</span>
            <span class="n">p_yz</span> <span class="o">=</span> <span class="n">marginal_yz_with_cutoff</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ZERO</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_time</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">first_time</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cui</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cui</span><span class="o">.</span><span class="n">Y</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cui</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
                            <span class="n">xyz</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>
                            <span class="k">if</span> <span class="n">xyz</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">p</span><span class="p">[</span><span class="n">xyz</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">ZERO</span><span class="p">:</span>
                                <span class="c1"># equation</span>
                                <span class="n">p_xyz</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">xyz</span><span class="p">]</span>
                                <span class="n">rhs</span> <span class="o">=</span> <span class="o">-</span><span class="n">log</span><span class="p">(</span><span class="n">p_xyz</span> <span class="o">/</span> <span class="n">p_yz</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span>  <span class="c1"># &gt;= 0</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">constr_geq</span><span class="p">[</span><span class="n">xyz</span><span class="p">]</span><span class="o">.</span><span class="n">setAttr</span><span class="p">(</span><span class="s2">&quot;rhs&quot;</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">constr_leq</span><span class="p">[</span><span class="n">xyz</span><span class="p">]</span><span class="o">.</span><span class="n">setAttr</span><span class="p">(</span><span class="s2">&quot;rhs&quot;</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="c1"># inequality</span>
                                <span class="k">if</span> <span class="n">xyz</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">constr_leq</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">constr_leq</span><span class="p">[</span><span class="n">xyz</span><span class="p">])</span>
                                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">constr_leq</span><span class="p">[</span><span class="n">xyz</span><span class="p">]</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="n">p_yz</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">p_yz</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="n">rhs</span> <span class="o">=</span> <span class="mf">1.e400</span>       <span class="c1"># don&#39;t need ZERO here,  marginal_yz_w_cutoff()</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">rhs</span> <span class="o">=</span> <span class="mf">0.</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">constr_geq</span><span class="p">[</span><span class="n">xyz</span><span class="p">]</span><span class="o">.</span><span class="n">setAttr</span><span class="p">(</span><span class="s2">&quot;rhs&quot;</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
                            <span class="c1"># if</span>
                        <span class="c1">#^ for z</span>
                    <span class="c1">#^ for y</span>
                <span class="c1">#^ for x</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># same, but different loop</span>
                <span class="k">for</span> <span class="n">xyz</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">xyz</span>
                    <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="n">xyz</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">ZERO</span><span class="p">:</span>
                        <span class="c1"># equation</span>
                        <span class="n">p_xyz</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">xyz</span><span class="p">]</span>
                        <span class="n">rhs</span> <span class="o">=</span> <span class="o">-</span><span class="n">log</span><span class="p">(</span><span class="n">p_xyz</span> <span class="o">/</span> <span class="n">p_yz</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span>  <span class="c1"># &gt;= 0</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">constr_leq</span><span class="p">[</span><span class="n">xyz</span><span class="p">]</span><span class="o">.</span><span class="n">setAttr</span><span class="p">(</span><span class="s2">&quot;rhs&quot;</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">constr_geq</span><span class="p">[</span><span class="n">xyz</span><span class="p">]</span><span class="o">.</span><span class="n">setAttr</span><span class="p">(</span><span class="s2">&quot;rhs&quot;</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># inequality</span>
                        <span class="k">if</span> <span class="n">xyz</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">constr_leq</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">constr_leq</span><span class="p">[</span><span class="n">xyz</span><span class="p">])</span>
                            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">constr_leq</span><span class="p">[</span><span class="n">xyz</span><span class="p">]</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="n">p_yz</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">p_yz</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">rhs</span> <span class="o">=</span> <span class="mf">1.e400</span>       <span class="c1"># don&#39;t need ZERO here,  marginal_yz_w_cutoff()</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">rhs</span> <span class="o">=</span> <span class="mf">0.</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">constr_geq</span><span class="p">[</span><span class="n">xyz</span><span class="p">]</span><span class="o">.</span><span class="n">setAttr</span><span class="p">(</span><span class="s2">&quot;rhs&quot;</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">gurobi</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">OPTIMAL</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_var</span><span class="o">.</span><span class="n">getAttr</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">t</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span></div></div>
        <span class="c1">#^ solve()</span>
    <span class="c1">#^ class KKT_System</span>

<div class="viewcode-block" id="Compute_UI.solve_KKT_system"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.Compute_UI.solve_KKT_system">[docs]</a>    <span class="k">def</span> <span class="nf">solve_KKT_system</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">ZERO</span><span class="o">=</span><span class="mf">1.e-1000</span><span class="p">):</span>

        <span class="n">model</span> <span class="o">=</span> <span class="n">gurobi</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;kkt&quot;</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">logToConsole</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Add the variables:</span>
        <span class="n">t_var</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">lambda_vars</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">mu_vars</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="n">t_var</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;t&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">:</span>
                <span class="n">lambda_vars</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;lambda(</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
                <span class="n">mu_vars</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;mu(</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
        <span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

        <span class="c1"># Add the constraints:</span>
        <span class="n">p_yz</span> <span class="o">=</span> <span class="n">marginal_yz_with_cutoff</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ZERO</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">ZERO</span><span class="p">:</span>
                        <span class="c1"># equation</span>
                        <span class="n">p_xyz</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span>
                        <span class="n">rhs</span> <span class="o">=</span> <span class="o">-</span><span class="n">log</span><span class="p">(</span><span class="n">p_xyz</span> <span class="o">/</span> <span class="n">p_yz</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span>  <span class="c1"># &gt;= 0</span>
                        <span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">lambda_vars</span><span class="p">[</span>
                                        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">+</span> <span class="n">mu_vars</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">-</span> <span class="n">rhs</span> <span class="o">&lt;=</span> <span class="n">t_var</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;eqn+(</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
                        <span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">lambda_vars</span><span class="p">[</span>
                                        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">+</span> <span class="n">mu_vars</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">-</span> <span class="n">rhs</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="n">t_var</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;eqn-(</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># inequality</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="n">p_yz</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">p_yz</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">rhs</span> <span class="o">=</span> <span class="mf">1.e400</span>       <span class="c1"># don&#39;t need ZERO here,  marginal_yz_w_cutoff()</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">rhs</span> <span class="o">=</span> <span class="mf">0.</span>
                        <span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">lambda_vars</span><span class="p">[</span>
                                        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">+</span> <span class="n">mu_vars</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">-</span> <span class="n">rhs</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="n">t_var</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ieq(</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
                    <span class="c1"># if</span>
                <span class="c1">#^ for z</span>
            <span class="c1">#^ for y</span>
        <span class="c1">#^ for x</span>

        <span class="c1"># Run Gurobi:</span>
        <span class="n">model</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">gurobi</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">OPTIMAL</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t_var</span><span class="o">.</span><span class="n">getAttr</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span></div>
    <span class="c1">#^ solve_KKT_system()</span>

<div class="viewcode-block" id="Compute_UI.make_KKT_lp"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.Compute_UI.make_KKT_lp">[docs]</a>    <span class="k">def</span> <span class="nf">make_KKT_lp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="n">x_idx</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
            <span class="n">x_idx</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_idx</span><span class="p">)</span>
        <span class="n">y_idx</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">:</span>
            <span class="n">y_idx</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_idx</span><span class="p">)</span>
        <span class="n">z_idx</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
            <span class="n">z_idx</span><span class="p">[</span><span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">z_idx</span><span class="p">)</span>

        <span class="n">p_yz</span> <span class="o">=</span> <span class="n">marginal_yz</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="n">filecontent</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">filecontent</span> <span class="o">+=</span> <span class="s2">&quot;Minimize</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">filecontent</span> <span class="o">+=</span> <span class="s2">&quot;Obj: t</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">filecontent</span> <span class="o">+=</span> <span class="s2">&quot;Subject To</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
                    <span class="n">lhs</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="n">lhs</span> <span class="o">+=</span> <span class="s2">&quot; lambda&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x_idx</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">y_idx</span><span class="p">[</span><span class="n">y</span><span class="p">])</span>
                    <span class="n">lhs</span> <span class="o">+=</span> <span class="s2">&quot; + &quot;</span>
                    <span class="n">lhs</span> <span class="o">+=</span> <span class="s2">&quot; mu&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x_idx</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">z_idx</span><span class="p">[</span><span class="n">z</span><span class="p">])</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c1"># equation</span>
                        <span class="n">p_xzy</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span>
                        <span class="n">rhs</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1000</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">p_xzy</span> <span class="o">/</span> <span class="n">p_yz</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span>  <span class="c1"># &gt;= 0</span>
                        <span class="n">filecontent</span> <span class="o">+=</span> <span class="s2">&quot;p(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x_idx</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">y_idx</span><span class="p">[</span><span class="n">y</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">z_idx</span><span class="p">[</span><span class="n">z</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;):  &quot;</span> <span class="o">+</span> <span class="n">lhs</span> <span class="o">+</span> <span class="s2">&quot;   -t &lt;= &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="n">filecontent</span> <span class="o">+=</span> <span class="s2">&quot;p(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x_idx</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">y_idx</span><span class="p">[</span><span class="n">y</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">z_idx</span><span class="p">[</span><span class="n">z</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;):  &quot;</span> <span class="o">+</span> <span class="n">lhs</span> <span class="o">+</span> <span class="s2">&quot;   +t &gt;= &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># inequality</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="n">p_yz</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">p_yz</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">rhs</span> <span class="o">=</span> <span class="mf">1.e100</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">rhs</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">filecontent</span> <span class="o">+=</span> <span class="s2">&quot;p(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x_idx</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">y_idx</span><span class="p">[</span><span class="n">y</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                            <span class="n">z_idx</span><span class="p">[</span><span class="n">z</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;):  &quot;</span> <span class="o">+</span> <span class="n">lhs</span> <span class="o">+</span> <span class="s2">&quot;   +t &gt;= &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="c1">#^ for</span>
            <span class="c1">#^ for</span>
        <span class="c1">#^ for</span>
        <span class="n">filecontent</span> <span class="o">+=</span> <span class="s2">&quot;END</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Writing KKT system to file &quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">thefile</span><span class="p">:</span>
            <span class="n">thefile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filecontent</span><span class="p">)</span></div>
    <span class="c1">#^ make_KKT_lp()</span>

<div class="viewcode-block" id="Compute_UI.try_to_improve_by_LP"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.Compute_UI.try_to_improve_by_LP">[docs]</a>    <span class="k">def</span> <span class="nf">try_to_improve_by_LP</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>

        <span class="n">model</span> <span class="o">=</span> <span class="n">gurobi</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;improve&quot;</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">logToConsole</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">p_yz</span> <span class="o">=</span> <span class="n">marginal_yz</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="c1"># Add the variables:</span>
        <span class="n">p_xyz_vars</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c1"># equation</span>
                        <span class="n">p_xyz</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span>
                        <span class="n">obj</span> <span class="o">=</span> <span class="o">-</span><span class="n">log</span><span class="p">(</span><span class="n">p_xyz</span> <span class="o">/</span> <span class="n">p_yz</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span>  <span class="c1"># &gt;= 0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># inequality</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="n">p_yz</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">p_yz</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">obj</span> <span class="o">=</span> <span class="mf">1.e100</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">obj</span> <span class="o">=</span> <span class="mf">0.</span>
                    <span class="n">p_xyz_vars</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span>
                        <span class="n">obj</span><span class="o">=</span><span class="n">rhs</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;p(</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
                    <span class="c1"># if</span>
                <span class="c1">#^ for z</span>
            <span class="c1">#^ for y</span>
        <span class="c1">#^ for x</span>

        <span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

        <span class="c1"># Add constraints:</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">:</span>
                <span class="n">lambda_vars</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;lambda(</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
                <span class="n">mu_vars</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;mu(</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
        <span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

        <span class="c1"># Add the constraints:</span>
        <span class="n">p_yz</span> <span class="o">=</span> <span class="n">marginal_yz</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="c1"># Run Gurobi:</span>
        <span class="n">model</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">gurobi</span><span class="o">.</span><span class="n">GRB</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">OPTIMAL</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t_var</span><span class="o">.</span><span class="n">getAttr</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;There has been a terrible mistake! [try_to_improve_LP()]&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mf">1.e400</span></div>
    <span class="c1">#^ try_to_improve_by_LP()</span>

<div class="viewcode-block" id="Compute_UI.check_guess"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.Compute_UI.check_guess">[docs]</a>    <span class="k">def</span> <span class="nf">check_guess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">kkt_filename</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="n">infeas_2nm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_feasible</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">kkt_viol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solve_KKT_system</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kkt_viol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_KKT_sol</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kkt_filename</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kkt_filename</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">kkt_filename</span> <span class="o">=</span> <span class="s2">&quot;kkt.lp&quot;</span>
            <span class="n">cui</span><span class="o">.</span><span class="n">make_KKT_lp</span><span class="p">(</span><span class="n">cui</span><span class="o">.</span><span class="n">p_final</span><span class="p">,</span> <span class="n">kkt_filename</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">infeas_2nm</span><span class="p">,</span> <span class="n">kkt_viol</span></div>
    <span class="c1"># check_guess()</span>

<div class="viewcode-block" id="Compute_UI.search_for_kkt_solution"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.Compute_UI.search_for_kkt_solution">[docs]</a>    <span class="k">def</span> <span class="nf">search_for_kkt_solution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">stop_search_kkt_eps</span><span class="o">=-</span><span class="mf">1.</span><span class="p">,</span> <span class="n">stop_search_prob_eps</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">min_viol</span> <span class="o">=</span> <span class="mf">1.e1000</span>
        <span class="n">arg_min_viol</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">max_viol</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.e1000</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="mf">1.e1000</span>
        <span class="n">kkt_viol_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">the_ZERO_range</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="n">the_ZERO_range</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">the_ZERO_range</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="n">prev_viol</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.e1000</span>
        <span class="k">if</span> <span class="n">show_progress</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Searching...&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">last_best_guess</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">last_best_guess_kkt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">kktsys</span> <span class="o">=</span> <span class="n">Compute_UI</span><span class="o">.</span><span class="n">KKT_System</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">the_ZERO</span> <span class="ow">in</span> <span class="n">the_ZERO_range</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">show_progress</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">the_ZERO</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
            <span class="n">kkt_viol</span> <span class="o">=</span> <span class="n">kktsys</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">the_ZERO</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">show_progress</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">kkt_viol</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;; &quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">kkt_viol</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">max_viol</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_viol</span><span class="p">,</span> <span class="n">kkt_viol</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">max_viol</span> <span class="o">=</span> <span class="mf">1.e1000</span>
            <span class="k">if</span> <span class="n">kkt_viol</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">the_ZERO</span> <span class="o">&lt;=</span> <span class="n">stop_search_prob_eps</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">the_ZERO</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">kkt_viol</span> <span class="o">&lt;</span> <span class="n">last_best_guess_kkt</span><span class="p">:</span>
                        <span class="n">last_best_guess</span> <span class="o">=</span> <span class="n">the_ZERO</span>
                        <span class="n">last_best_guess_kkt</span> <span class="o">=</span> <span class="n">kkt_viol</span>
                    <span class="k">if</span> <span class="n">kkt_viol</span> <span class="o">&lt;</span> <span class="n">min_viol</span><span class="p">:</span>
                        <span class="n">min_viol</span> <span class="o">=</span> <span class="n">kkt_viol</span>
                        <span class="n">arg_min_viol</span> <span class="o">=</span> <span class="n">the_ZERO</span>
                        <span class="k">if</span> <span class="n">kkt_viol</span> <span class="o">&lt;=</span> <span class="n">stop_search_kkt_eps</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">show_progress</span><span class="p">:</span>
                                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;[Breaking from search.]&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                            <span class="k">break</span>
                    <span class="n">delta</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">prev_viol</span> <span class="o">-</span> <span class="n">kkt_viol</span><span class="p">)</span>
                    <span class="n">prev_viol</span> <span class="o">=</span> <span class="n">kkt_viol</span>
            <span class="c1">#^ if kkt_viol finite</span>
            <span class="n">kkt_viol_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">the_ZERO</span><span class="p">,</span> <span class="n">kkt_viol</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">show_progress</span> <span class="ow">is</span> <span class="bp">False</span> <span class="ow">and</span> <span class="n">the_ZERO</span> <span class="o">&gt;</span> <span class="n">stop_search_prob_eps</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="c1">#^ for the_ZERO</span>
        <span class="k">if</span> <span class="n">show_progress</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Done</span><span class="se">\n</span><span class="s2">Min violation&quot;</span><span class="p">,</span> <span class="n">min_viol</span><span class="p">,</span> <span class="s2">&quot;with the_ZERO=&quot;</span><span class="p">,</span>
                  <span class="n">arg_min_viol</span><span class="p">,</span> <span class="s2">&quot;; non-monotonicity:&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">delta</span><span class="p">,</span> <span class="s2">&quot; max viol:&quot;</span><span class="p">,</span> <span class="n">max_viol</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">min_viol</span> <span class="o">&gt;</span> <span class="n">stop_search_kkt_eps</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">show_progress</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span>
                    <span class="s2">&quot;Oh bummer, that&#39;s too much KKT violation. Trying fallback: the_ZERO=&quot;</span><span class="p">,</span> <span class="n">last_best_guess</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">last_best_guess</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">arg_min_viol</span> <span class="o">=</span> <span class="n">last_best_guess</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">min_viol</span><span class="p">,</span> <span class="n">arg_min_viol</span><span class="p">,</span> <span class="o">-</span><span class="n">delta</span><span class="p">,</span> <span class="n">max_viol</span><span class="p">,</span> <span class="n">kkt_viol_list</span></div>
    <span class="c1"># search_for_kkt_solution()</span>

    <span class="c1">#*************************************************************************</span>

<div class="viewcode-block" id="Compute_UI.options"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.Compute_UI.options">[docs]</a>    <span class="k">def</span> <span class="nf">options</span><span class="p">():</span>
        <span class="k">pass</span></div></div>
        <span class="c1"># solvers.options[&#39;show_progress&#39;] = True, False # turns the output to the screen on or off (default: True).</span>
        <span class="c1"># solvers.options[&#39;maxiters&#39;     ] = 10          # maximum number of iterations (default: 100).</span>
        <span class="c1"># solvers.options[&#39;abstol&#39;       ] = 1.e-7       # absolute accuracy (default: 1e-7).</span>
        <span class="c1"># solvers.options[&#39;reltol&#39;       ] = 1.e-6       # relative accuracy (default: 1e-6).</span>
        <span class="c1"># solvers.options[&#39;feastol&#39;      ] = 1.e-7       # tolerance for feasibility conditions (default: 1e-7).</span>
        <span class="c1"># solvers.options[&#39;refinement&#39;   ] = 1           # number of iterative refinement steps when solving KKT equations (default: 1).</span>
    <span class="c1">#^ options()</span>

<span class="c1">#^ class Compute_UI</span>


<div class="viewcode-block" id="I_X_YZ"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.I_X_YZ">[docs]</a><span class="k">def</span> <span class="nf">I_X_YZ</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="c1"># Mutual information I( X ; YZ )</span>
    <span class="n">p_x</span> <span class="o">=</span> <span class="n">marginal_x</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">p_yz</span> <span class="o">=</span> <span class="n">marginal_yz</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">mysum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">xyz</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mysum</span> <span class="o">+=</span> <span class="n">t</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">t</span> <span class="o">/</span> <span class="p">(</span><span class="n">p_x</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">*</span> <span class="n">p_yz</span><span class="p">[(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)]))</span>
    <span class="k">return</span> <span class="n">mysum</span> <span class="o">/</span> <span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span></div>
<span class="c1">#^ I_X_YZ()</span>


<div class="viewcode-block" id="I_X_Y"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.I_X_Y">[docs]</a><span class="k">def</span> <span class="nf">I_X_Y</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="c1"># Mutual information I( X ; Y )</span>
    <span class="n">p_x</span> <span class="o">=</span> <span class="n">marginal_x</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">p_y</span> <span class="o">=</span> <span class="n">marginal_y</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">p_xy</span> <span class="o">=</span> <span class="n">marginal_xy</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">mysum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">xy</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">p_xy</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">xy</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mysum</span> <span class="o">+=</span> <span class="n">t</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">t</span> <span class="o">/</span> <span class="p">(</span><span class="n">p_x</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">*</span> <span class="n">p_y</span><span class="p">[</span><span class="n">y</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">mysum</span> <span class="o">/</span> <span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span></div>
<span class="c1">#^ I_X_Y()</span>

<span class="c1"># Unique information in Y (if evaluated with respect to p)</span>
<div class="viewcode-block" id="cond_I_X_Y__Z"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.cond_I_X_Y__Z">[docs]</a><span class="k">def</span> <span class="nf">cond_I_X_Y__Z</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="c1"># Conditional mutual information I( X ; Y | Z )</span>
    <span class="n">p_z</span> <span class="o">=</span> <span class="n">marginal_z</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">p_xz</span> <span class="o">=</span> <span class="n">marginal_xz</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">p_yz</span> <span class="o">=</span> <span class="n">marginal_yz</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">mysum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">xyz</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mysum</span> <span class="o">+=</span> <span class="n">t</span> <span class="o">*</span> <span class="n">log</span><span class="p">((</span><span class="n">t</span> <span class="o">*</span> <span class="n">p_z</span><span class="p">[</span><span class="n">z</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">p_xz</span><span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">)]</span> <span class="o">*</span> <span class="n">p_yz</span><span class="p">[(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)]))</span>
    <span class="k">return</span> <span class="n">mysum</span> <span class="o">/</span> <span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span></div>
<span class="c1">#^ cond_I_X_Y__Z()</span>

<span class="c1"># Unique information in Y (if evaluated with respect to p)</span>
<div class="viewcode-block" id="cond_I_X_Z__Y"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.cond_I_X_Z__Y">[docs]</a><span class="k">def</span> <span class="nf">cond_I_X_Z__Y</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="c1"># Conditional mutual information I( X ; Y | Z )</span>
    <span class="n">p_y</span> <span class="o">=</span> <span class="n">marginal_y</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">p_xy</span> <span class="o">=</span> <span class="n">marginal_xy</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">p_yz</span> <span class="o">=</span> <span class="n">marginal_yz</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">mysum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">xyz</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mysum</span> <span class="o">+=</span> <span class="n">t</span> <span class="o">*</span> <span class="n">log</span><span class="p">((</span><span class="n">t</span> <span class="o">*</span> <span class="n">p_y</span><span class="p">[</span><span class="n">y</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">p_xy</span><span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)]</span> <span class="o">*</span> <span class="n">p_yz</span><span class="p">[(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)]))</span>
    <span class="k">return</span> <span class="n">mysum</span> <span class="o">/</span> <span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span></div>
<span class="c1">#^ cond_I_X_Y__Z()</span>

<span class="c1"># Synergistic Information</span>
<div class="viewcode-block" id="wriggle_CI"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.wriggle_CI">[docs]</a><span class="k">def</span> <span class="nf">wriggle_CI</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
    <span class="c1"># Calculate the synergistic info as the difference of tho MIs evaluated</span>
    <span class="c1"># with respect to p (see p. 2163)</span>
    <span class="k">return</span> <span class="n">I_X_YZ</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">I_X_YZ</span><span class="p">(</span><span class="n">q</span><span class="p">)</span></div>
<span class="c1">#^ wriggle_CI()</span>

<span class="c1"># Shared Information</span>
<div class="viewcode-block" id="wriggle_SI"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.wriggle_SI">[docs]</a><span class="k">def</span> <span class="nf">wriggle_SI</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
    <span class="c1"># Calculate the shared info as the CoI (Bertschinger, eq. (3)) evaluated</span>
    <span class="c1"># using q (see p. 2163), where the CoI is the MI(X:Y) - the unique info in</span>
    <span class="c1"># Y (which is I(X:Y|Z) evaluated with respect to p)</span>
    <span class="k">return</span> <span class="n">I_X_Y</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">-</span> <span class="n">cond_I_X_Y__Z</span><span class="p">(</span><span class="n">q</span><span class="p">)</span></div>
<span class="c1">#^ wriggle_SI()</span>


<span class="c1"># More Stats stuff</span>

<div class="viewcode-block" id="total_variation_distance"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.total_variation_distance">[docs]</a><span class="k">def</span> <span class="nf">total_variation_distance</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Q</span><span class="p">):</span>
    <span class="n">tvsum</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">P</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Q</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">tvsum</span> <span class="o">+=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">Q</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tvsum</span> <span class="o">+=</span> <span class="n">p</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">Q</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">P</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tvsum</span> <span class="o">+=</span> <span class="n">q</span>
    <span class="k">return</span> <span class="n">tvsum</span> <span class="o">/</span> <span class="mf">2.</span></div>
<span class="c1">#^ total_variation_distance()</span>


<div class="viewcode-block" id="support_variation"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.support_variation">[docs]</a><span class="k">def</span> <span class="nf">support_variation</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Q</span><span class="p">):</span>  <span class="c1"># \sup { P(A) | Q(A)=0 } + vice-vers</span>
    <span class="n">thesum</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">P</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Q</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">thesum</span> <span class="o">+=</span> <span class="n">p</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">Q</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">P</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">thesum</span> <span class="o">+=</span> <span class="n">q</span>
    <span class="k">return</span> <span class="n">thesum</span> <span class="o">/</span> <span class="mf">2.</span></div>
<span class="c1">#^ total_variation_distance()</span>


<div class="viewcode-block" id="kl_divergence"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.kl_divergence">[docs]</a><span class="k">def</span> <span class="nf">kl_divergence</span><span class="p">(</span><span class="n">Of</span><span class="p">,</span> <span class="n">From</span><span class="p">):</span>  <span class="c1"># KL-divergence of Q from P</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">Of</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">From</span>
    <span class="n">thesum</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">Q</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">q</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">P</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">thesum</span> <span class="o">+=</span> <span class="n">q</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">q</span> <span class="o">/</span> <span class="n">p</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">thesum</span> <span class="o">=</span> <span class="mf">1.e+400</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thesum</span> <span class="o">=</span> <span class="mf">1.e+400</span>
    <span class="k">return</span> <span class="n">thesum</span></div>
<span class="c1">#^ kl_divergence()</span>


<div class="viewcode-block" id="sorted_pdf"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.sorted_pdf">[docs]</a><span class="k">def</span> <span class="nf">sorted_pdf</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="n">p_str</span> <span class="o">=</span> <span class="s2">&quot;{&quot;</span>
    <span class="n">lead_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">p_str</span> <span class="o">+=</span> <span class="n">lead_str</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">lead_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span>
    <span class="n">p_str</span> <span class="o">+=</span> <span class="s2">&quot;}&quot;</span>
    <span class="k">return</span> <span class="n">p_str</span></div>
<span class="c1">#^ sorted_pdf()</span>


<div class="viewcode-block" id="gradient"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.gradient">[docs]</a><span class="k">def</span> <span class="nf">gradient</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="n">grad</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">p_yz</span> <span class="o">=</span> <span class="n">marginal_yz</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">xyz</span>
        <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="n">xyz</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">grad</span><span class="p">[</span><span class="n">xyz</span><span class="p">]</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">p_yz</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">/</span> <span class="n">p</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">p_yz</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">grad</span><span class="p">[</span><span class="n">xyz</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.e400</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">grad</span><span class="p">[</span><span class="n">xyz</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">return</span> <span class="n">grad</span></div>
<span class="c1">#^ gradient()</span>


<div class="viewcode-block" id="print_solution_stats"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.print_solution_stats">[docs]</a><span class="k">def</span> <span class="nf">print_solution_stats</span><span class="p">(</span><span class="n">soliter</span><span class="p">,</span> <span class="n">the_p</span><span class="p">,</span> <span class="n">pdf</span><span class="p">,</span> <span class="n">true_pdf</span><span class="p">,</span> <span class="n">true_result</span><span class="p">,</span> <span class="n">true_CI</span><span class="p">,</span> <span class="n">true_SI</span><span class="p">,</span> <span class="n">feas</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">kkt</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">true_pdf</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;SOLUTION #&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">soliter</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: d_TV(timeseries, true): &quot;</span><span class="p">,</span>
              <span class="n">total_variation_distance</span><span class="p">(</span><span class="n">pdf</span><span class="p">,</span> <span class="n">true_pdf</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">true_result</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;SOLUTION #&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">soliter</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: d_TV(result, true):     &quot;</span><span class="p">,</span>
              <span class="n">total_variation_distance</span><span class="p">(</span><span class="n">true_result</span><span class="p">,</span> <span class="n">the_p</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">true_pdf</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;SOLUTION #&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">soliter</span><span class="p">)</span> <span class="o">+</span>
              <span class="s2">&quot;: supp-dist(timeseries, true): &quot;</span><span class="p">,</span> <span class="n">support_variation</span><span class="p">(</span><span class="n">pdf</span><span class="p">,</span> <span class="n">true_pdf</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">true_result</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;SOLUTION #&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">soliter</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: supp-dist(result, true):     &quot;</span><span class="p">,</span>
              <span class="n">support_variation</span><span class="p">(</span><span class="n">true_result</span><span class="p">,</span> <span class="n">the_p</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">true_pdf</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;SOLUTION #&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">soliter</span><span class="p">)</span> <span class="o">+</span>
              <span class="s2">&quot;: KL-Divergence(true, timeseries): &quot;</span><span class="p">,</span> <span class="n">kl_divergence</span><span class="p">(</span><span class="n">true_pdf</span><span class="p">,</span> <span class="n">pdf</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">true_result</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;SOLUTION #&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">soliter</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: KL-Divergence(true, result):     &quot;</span><span class="p">,</span>
              <span class="n">kl_divergence</span><span class="p">(</span><span class="n">true_result</span><span class="p">,</span> <span class="n">the_p</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;SOLUTION #&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">soliter</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: CI-wriggle:&quot;</span><span class="p">,</span> <span class="n">wriggle_CI</span><span class="p">(</span><span class="n">pdf</span><span class="p">,</span> <span class="n">the_p</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">true_CI</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;SOLUTION #&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">soliter</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: CI-wriggle difference:&quot;</span><span class="p">,</span>
              <span class="nb">abs</span><span class="p">(</span><span class="n">wriggle_CI</span><span class="p">(</span><span class="n">pdf</span><span class="p">,</span> <span class="n">the_p</span><span class="p">)</span> <span class="o">-</span> <span class="n">true_CI</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;SOLUTION #&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">soliter</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: SI-wriggle:&quot;</span><span class="p">,</span> <span class="n">wriggle_SI</span><span class="p">(</span><span class="n">the_p</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">true_SI</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;SOLUTION #&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">soliter</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: SI-wriggle difference:&quot;</span><span class="p">,</span>
              <span class="nb">abs</span><span class="p">(</span><span class="n">wriggle_SI</span><span class="p">(</span><span class="n">the_p</span><span class="p">)</span> <span class="o">-</span> <span class="n">true_SI</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;SOLUTION #&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">soliter</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: 1-norm of violation: &quot;</span><span class="p">,</span> <span class="n">feas</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;SOLUTION #&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">soliter</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: KKT-system infeasibility: &quot;</span><span class="p">,</span> <span class="n">kkt</span><span class="p">)</span></div>
<span class="c1">#^ print_solution_stats()</span>


<div class="viewcode-block" id="solve_PDF"><a class="viewcode-back" href="../../idtxl.html#idtxl.synergy_tartu.solve_PDF">[docs]</a><span class="k">def</span> <span class="nf">solve_PDF</span><span class="p">(</span><span class="n">pdf</span><span class="p">,</span> <span class="n">true_pdf</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">true_result</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">true_CI</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">true_SI</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
              <span class="n">feas_eps</span><span class="o">=</span><span class="mf">1.e-10</span><span class="p">,</span> <span class="n">kkt_eps</span><span class="o">=</span><span class="mf">1.e-5</span><span class="p">,</span>
              <span class="n">feas_eps_2</span><span class="o">=</span><span class="mf">1.e-6</span><span class="p">,</span>  <span class="n">kkt_eps_2</span><span class="o">=.</span><span class="mo">01</span><span class="p">,</span>
              <span class="n">kkt_search_eps</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_zero_probability</span><span class="o">=</span><span class="mf">1.e-5</span><span class="p">,</span>  <span class="c1"># kkt_search_entropy_eps=1.e-5,</span>
              <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="c1"># turns the output to the screen on or off</span>
        <span class="n">solvers</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;show_progress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">solvers</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;show_progress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="c1"># Create marginals</span>
    <span class="n">p_xy</span> <span class="o">=</span> <span class="n">marginal_xy</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>
    <span class="n">p_xz</span> <span class="o">=</span> <span class="n">marginal_xz</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;solve_PDF(): xy-marginals =&quot;</span><span class="p">,</span> <span class="n">sorted_pdf</span><span class="p">(</span><span class="n">p_xy</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;solve_PDF(): xz-marginals =&quot;</span><span class="p">,</span> <span class="n">sorted_pdf</span><span class="p">(</span><span class="n">p_xz</span><span class="p">))</span>

    <span class="c1"># M A I N   L O O P</span>
    <span class="n">wCI</span> <span class="o">=</span> <span class="n">wSI</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.e+1000</span>
    <span class="n">the_p</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="n">feas</span> <span class="o">=</span> <span class="mf">1.e+1000</span>
    <span class="n">kkt</span> <span class="o">=</span> <span class="mf">1.e+1000</span>
    <span class="n">set_to_zero_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">main_loop_iter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="c1"># number of iterative refinement steps when solving KKT equations</span>
        <span class="c1"># (default: 1).</span>
        <span class="n">solvers</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;refinement&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="c1"># create Unique Information solver object</span>
        <span class="n">cui</span> <span class="o">=</span> <span class="n">Compute_UI</span><span class="p">(</span><span class="n">p_xy</span><span class="p">,</span> <span class="n">p_xz</span><span class="p">,</span> <span class="n">_set_to_zero</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="n">set_to_zero_list</span><span class="p">))</span>
        <span class="c1"># Let&#39;s go!</span>
        <span class="n">cui</span><span class="o">.</span><span class="n">solve_it</span><span class="p">(</span><span class="n">_eps</span><span class="o">=</span><span class="mf">1.e-400</span><span class="p">)</span>
        <span class="c1"># Done!</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;solve_PDF(): p_final =&quot;</span><span class="p">,</span> <span class="n">sorted_pdf</span><span class="p">(</span><span class="n">cui</span><span class="o">.</span><span class="n">p_final</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">true_result</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;solve_PDF(): true_result:&quot;</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span>
                <span class="n">true_result</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">the_p</span> <span class="o">=</span> <span class="n">cui</span><span class="o">.</span><span class="n">p_final</span>
        <span class="n">wCI</span> <span class="o">=</span> <span class="n">wriggle_CI</span><span class="p">(</span><span class="n">pdf</span><span class="p">,</span> <span class="n">the_p</span><span class="p">)</span>
        <span class="n">wSI</span> <span class="o">=</span> <span class="n">wriggle_SI</span><span class="p">(</span><span class="n">the_p</span><span class="p">)</span>
        <span class="n">wUI_Y</span> <span class="o">=</span> <span class="n">cond_I_X_Y__Z</span><span class="p">(</span><span class="n">the_p</span><span class="p">)</span>  <span class="c1"># PW: I added this to also get the UIs</span>
        <span class="n">wUI_Z</span> <span class="o">=</span> <span class="n">cond_I_X_Z__Y</span><span class="p">(</span><span class="n">the_p</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;solve_PDF(): Testing solution.&quot;</span><span class="p">)</span>
        <span class="n">feas</span><span class="p">,</span> <span class="n">kkt</span> <span class="o">=</span> <span class="n">cui</span><span class="o">.</span><span class="n">check_guess</span><span class="p">(</span><span class="n">cui</span><span class="o">.</span><span class="n">p_final</span><span class="p">,</span> <span class="n">kkt_filename</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">print_solution_stats</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">main_loop_iter</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">the_p</span><span class="p">,</span>
                                 <span class="n">pdf</span><span class="p">,</span> <span class="n">true_pdf</span><span class="p">,</span> <span class="n">true_result</span><span class="p">,</span> <span class="n">true_CI</span><span class="p">,</span> <span class="n">true_SI</span><span class="p">,</span> <span class="n">feas</span><span class="p">,</span> <span class="n">kkt</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kkt</span> <span class="o">&lt;=</span> <span class="n">kkt_eps</span> <span class="ow">and</span> <span class="n">feas</span> <span class="o">&lt;=</span> <span class="n">feas_eps</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;solve_PDF(): Done. Returning a solution with 1-norm of primal violation&quot;</span><span class="p">,</span>
                      <span class="n">feas</span><span class="p">,</span> <span class="s2">&quot;and maximum dual violation &quot;</span><span class="p">,</span> <span class="n">kkt</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">the_p</span><span class="p">,</span> <span class="n">feas</span><span class="p">,</span> <span class="n">kkt</span><span class="p">,</span> <span class="n">wCI</span><span class="p">,</span> <span class="n">wSI</span><span class="p">,</span> <span class="n">wUI_Y</span><span class="p">,</span> <span class="n">wUI_Z</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;solve_PDF(): Improving solution&quot;</span><span class="p">)</span>
            <span class="c1"># zero_probability = entropy_search(cui.p_final,kkt_search_entropy_eps)</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;solve_PDF(): Max ZERO probability = &quot;</span><span class="p">,</span>
                      <span class="n">max_zero_probability</span><span class="p">)</span>
            <span class="n">stop_search_kkt_eps</span> <span class="o">=</span> <span class="n">kkt_search_eps</span> <span class="o">*</span> <span class="n">kkt</span>
            <span class="n">kkt_search</span> <span class="o">=</span> <span class="n">cui</span><span class="o">.</span><span class="n">search_for_kkt_solution</span><span class="p">(</span>
                <span class="n">cui</span><span class="o">.</span><span class="n">p_final</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">stop_search_kkt_eps</span><span class="o">=</span><span class="n">stop_search_kkt_eps</span><span class="p">,</span> <span class="n">stop_search_prob_eps</span><span class="o">=</span><span class="n">max_zero_probability</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">kkt_search</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;solve_PDF(): KKT search turned up empty.&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">feas</span> <span class="o">&lt;=</span> <span class="n">feas_eps_2</span> <span class="ow">and</span> <span class="n">kkt</span> <span class="o">&lt;=</span> <span class="n">kkt_eps_2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span>
                            <span class="s2">&quot;solve_PDF(): Previous solution seems to be good enough (feas_eps_2, kkt_eps_2) &quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;solve_PDF(): Returning a solution with 1-norm of primal violation&quot;</span><span class="p">,</span>
                              <span class="n">feas</span><span class="p">,</span> <span class="s2">&quot;and maximum dual violation &quot;</span><span class="p">,</span> <span class="n">kkt</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">the_p</span><span class="p">,</span> <span class="n">feas</span><span class="p">,</span> <span class="n">kkt</span><span class="p">,</span> <span class="n">wCI</span><span class="p">,</span> <span class="n">wSI</span><span class="p">,</span> <span class="n">wUI_Y</span><span class="p">,</span> <span class="n">wUI_Z</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;solve_PDF(): Giving up.&quot;</span><span class="p">)</span>
                    <span class="k">break</span>   <span class="c1"># give up                               B R E A K</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">min_viol</span><span class="p">,</span> <span class="n">ZERO_min_viol</span><span class="p">,</span> <span class="n">non_monot</span><span class="p">,</span> <span class="n">max_viol</span><span class="p">,</span> <span class="n">kvl</span> <span class="o">=</span> <span class="n">kkt_search</span>
                <span class="k">if</span> <span class="n">ZERO_min_viol</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;solve_PDF(): KKT search cannot find improvement.&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">feas</span> <span class="o">&lt;=</span> <span class="n">feas_eps_2</span> <span class="ow">and</span> <span class="n">kkt</span> <span class="o">&lt;=</span> <span class="n">kkt_eps_2</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="k">print</span><span class="p">(</span>
                                <span class="s2">&quot;solve_PDF(): Previous solution seems to be good enough (feas_eps_2, kkt_eps_2) &quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;solve_PDF(): Returning a solution with 1-norm of primal violation&quot;</span><span class="p">,</span>
                                  <span class="n">feas</span><span class="p">,</span> <span class="s2">&quot;and maximum dual violation &quot;</span><span class="p">,</span> <span class="n">kkt</span><span class="p">)</span>
                        <span class="k">return</span> <span class="n">the_p</span><span class="p">,</span> <span class="n">feas</span><span class="p">,</span> <span class="n">kkt</span><span class="p">,</span> <span class="n">wCI</span><span class="p">,</span> <span class="n">wSI</span><span class="p">,</span> <span class="n">wUI_Y</span><span class="p">,</span> <span class="n">wUI_Z</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;solve_PDF(): Giving up.&quot;</span><span class="p">)</span>
                        <span class="k">break</span>   <span class="c1"># give up                           B R E A K</span>

                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;solve_PDF(): Set everything leq&quot;</span><span class="p">,</span>
                          <span class="n">ZERO_min_viol</span><span class="p">,</span> <span class="s2">&quot;to zero.&quot;</span><span class="p">)</span>
                <span class="n">p_new</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cui</span><span class="o">.</span><span class="n">p_final</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">ZERO_min_viol</span><span class="p">:</span>
                        <span class="n">p_new</span><span class="p">[</span><span class="n">xyz</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
                <span class="n">feas_new</span><span class="p">,</span> <span class="n">kkt_new</span> <span class="o">=</span> <span class="n">cui</span><span class="o">.</span><span class="n">check_guess</span><span class="p">(</span><span class="n">p_new</span><span class="p">,</span> <span class="n">kkt_filename</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;solve_PDF(): Tidied-up solution: &quot;</span><span class="p">,</span> <span class="n">sorted_pdf</span><span class="p">(</span><span class="n">p_new</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="n">print_solution_stats</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">main_loop_iter</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">p_new</span><span class="p">,</span> <span class="n">pdf</span><span class="p">,</span>
                                         <span class="n">true_pdf</span><span class="p">,</span> <span class="n">true_result</span><span class="p">,</span> <span class="n">true_CI</span><span class="p">,</span> <span class="n">true_SI</span><span class="p">,</span> <span class="n">feas_new</span><span class="p">,</span> <span class="n">kkt_new</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cui</span><span class="o">.</span><span class="n">p_final</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="n">ZERO_min_viol</span><span class="p">:</span>
                        <span class="n">set_to_zero_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>

            <span class="k">del</span> <span class="n">cui</span>
        <span class="c1">#^ else (don&#39;t `until&#39;)</span>
    <span class="c1">#^ for iterations (REPEAT-UNTIL)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Giving up.  Returning a solution with 1-norm of primal violation&quot;</span><span class="p">,</span>
          <span class="n">feas</span><span class="p">,</span> <span class="s2">&quot;and maximum dual violation &quot;</span><span class="p">,</span> <span class="n">kkt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">the_p</span><span class="p">,</span> <span class="n">feas</span><span class="p">,</span> <span class="n">kkt</span><span class="p">,</span> <span class="n">wCI</span><span class="p">,</span> <span class="n">wSI</span><span class="p">,</span> <span class="n">wUI_Y</span><span class="p">,</span> <span class="n">wUI_Z</span></div>
<span class="c1"># solve_PDF()</span>
</pre></div>

                </div>
              </div>
            </div>
          </div>
        </div>
         
<div class="col-md-3 hidden-xs" id="sidebar-wrapper">
  <div class="sidebar hidden-xs" role="navigation" aria-label="main navigation">
<div id="searchbox" role="search">
  <h3>Quick search</h3>
  <form class="search form-inline" action="../../search.html" method="get">
      <div class="input-append input-group">
        <input type="text" class="search-query form-control" name="q" placeholder="Search...">
        <span class="input-group-btn">
        <input type="submit" class="btn" value="Go" />
        </span>
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  </div>
</div> 
        
      </div><!-- /row -->

      <!-- row -->
      <div class="row footer-relbar">
<div id="navbar-related" class=" related navbar navbar-default" role="navigation" aria-label="related navigation">
  <div class="navbar-inner">
    <ul class="nav navbar-nav ">
        <li><a href="../../index.html">IDTxl 0.1 documentation</a></li>
    </ul>
<ul class="nav navbar-nav pull-right hidden-xs hidden-sm">
      
        <li><a href="../../py-modindex.html" title="Python Module Index" >modules</a></li>
        <li><a href="../../genindex.html" title="General Index" >index</a></li>
        <li><a href="../index.html" >Module code</a></li>
        <li><a href="#">top</a></li> 
      
    </ul>
  </div>
</div>
      </div><!-- /row -->

      <!-- footer -->
      <footer role="contentinfo">
          &copy; Copyright 2016, Patricia Wollstadt, Michael Wibral, Joe T. Lizier, Finn Connor, Raul Vicente.
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.6.
      </footer>
      <!-- /footer -->

    </div>
    <!-- /container -->

  </body>
</html>